---
interface InsightModule {
    title: string;
    pubDate: string;
    image: any;
    category: string;
}

const allInsightModules = import.meta.glob<InsightModule>(
    "../pages/articles/*.astro",
    {
        eager: true,
    },
);

const allInsights = Object.entries(allInsightModules).map(([path, module]) => {
    const url = path
        .replace("../pages/articles/", "/articles/")
        .replace(".astro", "/");
    return {
        url: url,
        title: module.title,
        pubDate: module.pubDate,
        image: module.image,
        category: module.category,
    };
});

const publishedInsights = allInsights.filter((insight) => insight.pubDate);

const sortedInsights = publishedInsights.sort(
    (a, b) => new Date(b.pubDate).valueOf() - new Date(a.pubDate).valueOf(),
);

const latestInsights = sortedInsights.slice(0, 3);
---

<section id="insights">
    <div class="container">
        <h2 class="centered-heading fade-in">INSIGHTS & RESOURCES</h2>
        <div class="insights-grid">
            {
                latestInsights.map((insight, index) => (
                    <article
                        class="insight-card fade-in"
                        style={`transition-delay: ${index * 0.1}s;`}
                    >
                        <div
                            class="card-visual"
                            style={`background-image: url('${insight.image.src}');`}
                        ></div>
                        <div class="card-content">
                            <span class="card-tag">
                                {insight.category || "Article"}
                            </span>
                            <h3>
                                <a href={insight.url}>{insight.title}</a>
                            </h3>
                            <p class="read-more">Read More &rarr;</p>
                        </div>
                    </article>
                ))
            }
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <a href="/insights/" class="btn btn-primary">View All Insights</a>
        </div>
    </div>
</section>
